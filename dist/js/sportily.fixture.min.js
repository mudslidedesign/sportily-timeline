(function(){var a;a=angular.module("sportily.fixture",["restangular","sportily.fixture.filters","sportily.fixture.service","sportily.fixture.templates"]),a.directive("sportilyFixture",["FixtureService",function(a){return{restrict:"A",scope:!0,link:function(b,c,d,e){if(d.sportilyFixture)return a.get(d.sportilyFixture).then(function(a){return b.fixture=a})}}}]),a.directive("sportilyTimeline",function(){return{restrict:"E",require:"^sportilyFixture",templateUrl:"templates/sportily/fixture/timeline.html"}}),a.directive("sportilyScores",function(){return{restrict:"E",require:"^sportilyFixture",templateUrl:"templates/sportily/fixture/scores.html"}})}).call(this),function(){var a;a=angular.module("sportily.fixture.filters",[]),a.filter("person",function(){return function(a){return a.given_name+" "+a.family_name}}),String.prototype.ucfirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.padLeft=function(a,b){return this.length>=b?this:(a+this).padLeft(a,b)},a.filter("gameTime",function(){return function(a){var b,c,d,e,f;return b=moment.duration(a),c=""+b.hours(),d=""+b.minutes(),e=""+b.seconds(),f=d.padLeft("0",2)+":"+e.padLeft("0",2),b.hours()>0&&(f=c+":"+f),f}}),a.filter("minutes",function(){return function(a){return~~(a/6e4)+"’"}}),a.filter("reverse",function(){return function(a){if(a)return a.slice().reverse()}})}.call(this),function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}};c=angular.module("sportily.fixture.service",["sportily.api"]),a=function(){function a(a,b,c,e,f){var g,h,i,j;for(this.q=a,this.interval=b,this.details=c,this.events=e,this.participants=f,this._updateGameState=d(this._updateGameState,this),this._updateGameTime=d(this._updateGameTime,this),this._refreshDetails=d(this._refreshDetails,this),this._pushEvent=d(this._pushEvent,this),this._updateGameState(),j=this.events,h=0,i=j.length;h<i;h++)g=j[h],this._linkEvent(g)}return a.prototype.happenedAt=function(a){var b,c,d;return c=a.split(":"),b=c[0],d=c[1],this.state.startedAt.clone().add(b,"minutes").add(d,"seconds").add(this.state.pausedFor)},a.prototype.addEvent=function(a){var b;return b=this._createEvent(a),b.then(this._pushEvent).then(this._updateGameState).then(this._refreshDetails),b},a.prototype.deleteEvent=function(a){var b;return b=this._deleteEvent(a),b.then(this._updateGameState).then(this._refreshDetails),b},a.prototype.start=function(a){return this.addEvent({type:"game_start",happened_at:a})},a.prototype.finish=function(a){return this.addEvent({type:"game_finish",happened_at:a})},a.prototype.pause=function(a){return this.addEvent({type:"game_pause",happened_at:a})},a.prototype.resume=function(a){return this.addEvent({type:"game_resume",happened_at:a})},a.prototype.addGoal=function(a,b,c,d,e){return this.addEvent({type:b?"own_goal":"goal",happened_at:e,entry_id:a,participant_id:c,notes:d})},a.prototype.addAssist=function(a,b,c){return this.addEvent({type:"assist",happened_at:c,participant_id:a,parent_id:b})},a.prototype.addFoul=function(a,b,c,d,e){return this.addEvent({type:"foul",happened_at:e,entry_id:a,participant_id:b,penalty_seconds:c,notes:d})},a.prototype.getParticipants=function(a){return _.filter(this.participants,function(b){return function(b){return b.entry_id===a}}())},a.prototype.toggleParticipant=function(a,b){var c;if(a.role)return c=this._findParticipant(a),c?this._removeParticipant(c):this._addParticipant(a,b)},a.prototype.addParticipant=function(a,b){var c;if(a.role)return c=this._findParticipant(a),c?this.q.when(c):this._addParticipant(a,b)},a.prototype.removeParticipant=function(a,b){var c;if(a.role)return c=this._findParticipant(a),c?this._removeParticipant(c):this.q.when(!0)},a.prototype._addParticipant=function(a,b){var c;return c={fixture_id:this.details.id,role_id:a.role.id,entry_id:b},this.participants.post(c).then(function(a){return function(b){return a.participants.push(b),a.participants.lookup[b.id]=b}}(this))},a.prototype._removeParticipant=function(a){return a.remove().then(function(b){return function(){return _.remove(b.participants,a),delete b.participants.lookup[a.id]}}(this))},a.prototype._findParticipant=function(a){return _.find(this.participants,function(b){return b.role_id===a.role.id})},a.prototype._createEvent=function(a){var b;return a.fixture_id=this.details.id,a.happened_at=(null!=(b=a.happened_at)?b:moment()).format(),this.events.post(a)},a.prototype._pushEvent=function(a){return this.events.push(a),this.events.lookup[a.id]=a,this._linkEvent(a)},a.prototype._deleteEvent=function(a){return a.remove().then(function(b){return function(){return _.remove(b.events,a),delete b.events.lookup[a.id]}}(this))},a.prototype._linkEvent=function(a){var b;if(a.parent_id)return b=this.events.lookup[a.parent_id],b.children||(b.children=[]),b.children.push(a)},a.prototype._startTimer=function(){if(!this.timer)return this.timer=this.interval(this._updateGameTime,500)},a.prototype._stopTimer=function(){return this.timer&&this.interval.cancel(this.timer),this.timer=void 0},a.prototype._refreshDetails=function(){return this.details.get().then(function(a){return function(b){return a.details=b}}(this))},a.prototype.refreshParticipants=function(){return this.participants.get().then(function(a){return function(b){return a.participants=b}}(this))},a.prototype._updateGameTime=function(){var a,b,c,d;if(b=null!=(c=this.state.pausedAt)?c:moment(),this.state.gameTime=b.diff(this.state.startedAt)-this.state.pausedFor,d=this.events,a=d[d.length-1],null!=a)return this.state.gameTime=Math.max(this.state.gameTime,a.game_time)},a.prototype._updateGameState=function(){var a;return this.state={inProgress:!1,started:!1,startedAt:null,finished:!1,paused:!1,pausedAt:null,pausedFor:0,gameTime:null},a=null,this.events.forEach(function(b){return function(c){switch(a=moment(c.happened_at),c.type){case"game_start":b.state.started=!0,b.state.startedAt=a,b._startTimer();break;case"game_finish":b.state.finished=!0,b.state.paused=!0,b._stopTimer();break;case"game_pause":b.state.paused=!0,b.state.pausedAt=a,b._stopTimer();break;case"game_resume":b.state.paused=!1,b.state.pausedFor+=a.diff(b.state.pausedAt),b.state.pausedAt=null,b._startTimer()}return c.game_time=a.diff(b.state.startedAt)-b.state.pausedFor}}(this)),this.state.inProgress=this.state.started&&!this.state.finished,this._updateGameTime()},a}(),b=function(){function b(a,b,c,d,e){this.q=a,this.interval=b,this.Fixtures=c,this.Events=d,this.Participants=e}return b.prototype.get=function(b){var c;return c={details:this._details(b),events:this._events(b),participants:this._participants(b)},this.q.all(c).then(function(b){return function(c){var d,e,f;return d=c.details,e=c.events,f=c.participants,new a(b.q,b.interval,d,e,f)}}(this))},b.prototype._details=function(a){return this.Fixtures.one(a).get()},b.prototype._events=function(a){return this.Events.getList({fixture_id:a})},b.prototype._participants=function(a){return this.Participants.getList({fixture_id:a})},b}(),c.service("FixtureService",["$q","$interval","Fixtures","Events","Participants",b])}.call(this),angular.module("sportily.fixture.templates",["templates/sportily/fixture/scores.html","templates/sportily/fixture/timeline.html","templates/sportily/fixture/timeline/assist.html","templates/sportily/fixture/timeline/foul.html","templates/sportily/fixture/timeline/game_endperiod.html","templates/sportily/fixture/timeline/game_finish.html","templates/sportily/fixture/timeline/game_pause.html","templates/sportily/fixture/timeline/game_resume.html","templates/sportily/fixture/timeline/game_start.html","templates/sportily/fixture/timeline/goal.html","templates/sportily/fixture/timeline/own_goal.html"]),angular.module("templates/sportily/fixture/scores.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/scores.html",'<span class="sportily-scores">\n    <span class="sportily-scores__home">{{ fixture.details.home_entry.result.score }}</span>\n    <span class="sportily-scores__vs">–</span>\n    <span class="sportily-scores__home">{{ fixture.details.away_entry.result.score }}</span>\n<span>\n')}]),angular.module("templates/sportily/fixture/timeline.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline.html",'<ul class="timeline">\n    <li class="timeline__item" ng-if="fixture.state.inProgress">\n        <div class="event event--flow">{{ fixture.state.gameTime | gameTime }}</div>\n    </li>\n    <li class="timeline__item"\n        ng-repeat="event in fixture.events | reverse"\n        ng-include="\'templates/sportily/fixture/timeline/\' + event.type + \'.html\'">\n    </li>\n</ul>\n')}]),angular.module("templates/sportily/fixture/timeline/assist.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline/assist.html","")}]),angular.module("templates/sportily/fixture/timeline/foul.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline/foul.html",'<div class="event event--foul"\n    ng-class="{ \'event--home\' : event.entry_id == fixture.details.home_entry.division_entry_id }">\n    <div class="event__icon"><i class="fa fa-thumbs-down"></i></div>\n    <div class="event__panel">\n        <div class="event__time">{{:: event.game_time | gameTime }}</div>\n        <div class="event__description">\n            Foul committed by {{:: fixture.participants.lookup[event.participant_id].name | person }}\n        </div>\n        <div class="event__aux" ng-if="event.penalty_seconds">\n            Awarded {{:: event.penalty_seconds / 60 }} penalty minutes\n        </div>\n        <div class="event__notes" ng-if="event.notes">\n            “{{:: event.notes }}”\n        </div>\n    </div>\n    <div delete-event="event" fixture="fixture" name="Foul committed by {{:: fixture.participants.lookup[event.participant_id].name | person }}"></div>\n</div>\n')}]),angular.module("templates/sportily/fixture/timeline/game_endperiod.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline/game_endperiod.html",'<div class="event event--flow">End Period</div>\n')}]),angular.module("templates/sportily/fixture/timeline/game_finish.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline/game_finish.html",'<div class="event event--flow">Full-time</div>\n')}]),angular.module("templates/sportily/fixture/timeline/game_pause.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline/game_pause.html","")}]),angular.module("templates/sportily/fixture/timeline/game_resume.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline/game_resume.html","")}]),angular.module("templates/sportily/fixture/timeline/game_start.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline/game_start.html",'<div class="event event--flow">Face-off</div>\n')}]),angular.module("templates/sportily/fixture/timeline/goal.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline/goal.html",'<div class="event event--goal"\n    ng-class="{ \'event--home\' : event.entry_id == fixture.details.home_entry.division_entry_id }">\n    <div class="event__icon"><i class="fa fa-star"></i></div>\n    <div class="event__panel">\n        <div class="event__time">{{:: event.game_time | gameTime }}</div>\n        <div class="event__description">\n            Goal! Scored by {{:: fixture.participants.lookup[event.participant_id].name | person }}.\n        </div>\n        <div class="event__aux" ng-if="event.children">\n            Assisted by\n            <span ng-repeat="child in event.children">{{ $first ? \'\' : $last ? \' and \' : \', \' }}{{:: fixture.participants.lookup[child.participant_id].name | person }}</span>\n        </div>\n        <div class="event__notes" ng-if="event.notes">\n            “{{:: event.notes }}”\n        </div>\n    </div>\n    <div delete-event="event" fixture="fixture" name="Goal! Scored by {{:: fixture.participants.lookup[event.participant_id].name | person }}"></div>\n</div>\n')}]),angular.module("templates/sportily/fixture/timeline/own_goal.html",[]).run(["$templateCache",function(a){a.put("templates/sportily/fixture/timeline/own_goal.html",'<div class="event event--own_goal"\n    ng-class="{ \'event--home\' : event.entry_id != fixture.details.home_entry.division_entry_id }">\n    <div class="event__icon"><i class="fa fa-star"></i></div>\n    <div class="event__panel">\n        <div class="event__time">{{:: event.game_time | gameTime }}</div>\n        <div class="event__description">\n            Own Goal!\n        </div>\n        <div class="event__notes" ng-if="event.notes">\n            “{{:: event.notes }}”\n        </div>\n    </div>\n    <div delete-event="event" fixture="fixture" name="Own Goal!"></div>\n</div>\n')}]);
//# sourceMappingURL=sportily.fixture.min.js.map